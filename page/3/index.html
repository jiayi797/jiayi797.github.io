<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 5.4.0">
<!-- Referrer Policy调整致不蒜子单页面统计出错:https://senorui.top/posts/c33f.html -->
<meta name="referrer" content="no-referrer-when-downgrade">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"jiayi797.github.io","root":"/","scheme":"Muse","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":false,"show_result":false,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":false,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},"path":"search.xml"};
  </script>

  <meta name="description" content=".">
<meta property="og:type" content="website">
<meta property="og:title" content="甲乙小朋友的房子">
<meta property="og:url" content="http://jiayi797.github.io/about/page/3/index.html">
<meta property="og:site_name" content="甲乙小朋友的房子">
<meta property="og:description" content=".">
<meta property="og:locale" content="zh_CN">
<meta property="article:author" content="jiayi797">
<meta name="twitter:card" content="summary">

<link rel="canonical" href="http://jiayi797.github.io/about/page/3/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : true,
    isPost : false,
    lang   : 'zh-CN'
  };
</script>

  <title>甲乙小朋友的房子</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">甲乙小朋友的房子</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
      <p class="site-subtitle" itemprop="description">甲乙小朋友很笨，但甲乙小朋友不会放弃</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档</a>

  </li>
  </ul>
</nav>




</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content index posts-expand">
            
      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://jiayi797.github.io/about/2018/07/08/OOD-%E7%94%B5%E6%A2%AF%E7%B3%BB%E7%BB%9F/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="jiayi797">
      <meta itemprop="description" content=".">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="甲乙小朋友的房子">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2018/07/08/OOD-%E7%94%B5%E6%A2%AF%E7%B3%BB%E7%BB%9F/" class="post-title-link" itemprop="url">OOD-电梯系统</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2018-07-08 16:36:39" itemprop="dateCreated datePublished" datetime="2018-07-08T16:36:39+08:00">2018-07-08</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2018-12-17 15:42:00" itemprop="dateModified" datetime="2018-12-17T15:42:00+08:00">2018-12-17</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/OOD/" itemprop="url" rel="index"><span itemprop="name">OOD</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>如何设计一个电梯系统？</p>
<h1 id="clarify">Clarify</h1>
<h1 id="core-object">Core Object</h1>
<p>Core Object，就是定义几个核心的类。承上启下，成为Use case的依据</p>
<p>步骤：</p>
<ol type="1">
<li>根据Input和Output线性分析 思考：电梯系统的输入和输出分别是什么呢？<img src="http://jiayi797.oss-cn-beijing.aliyuncs.com/2018-07-08-17-00-13.png" /></li>
<li>思考各个模块都有什么内容？ <img src="http://jiayi797.oss-cn-beijing.aliyuncs.com/2018-07-08-17-01-34.png" /> 需要注意的+Public,-Private,Protected(能被子类访问)这些属性</li>
</ol>
<h1 id="use-case">Use Case</h1>
<p>就是一个个功能。 根据一个个CoreObject，列举每个CoreObject对应有哪些Use case</p>
<ul>
<li>ElevatorSystem
<ul>
<li>处理请求，分发</li>
</ul></li>
<li>Request</li>
<li>Elevator
<ul>
<li>处理外部的请求（外面的人想进去，按按钮）</li>
<li>处理内部请求</li>
<li>开门</li>
<li>关门</li>
<li>检查重量</li>
</ul></li>
<li>ElevatorButton
<ul>
<li>按下去</li>
</ul></li>
</ul>
<h1 id="class">Class</h1>
<p>类图（Class diagram）</p>
<p><img src="http://jiayi797.oss-cn-beijing.aliyuncs.com/2018-07-08-17-11-17.png" /></p>
<ul>
<li><p>遍历每一个use case <img src="http://jiayi797.oss-cn-beijing.aliyuncs.com/2018-07-08-17-15-25.png" /></p></li>
<li><p>对每个use case更加详细描述在做什么</p>
<ul>
<li><p><strong>Handle request</strong>：就是要把请求分发给某个电梯。那就给ElevatorSystem加一个方法： <img src="http://jiayi797.oss-cn-beijing.aliyuncs.com/2018-07-08-17-14-49.png" /></p>
<p>一个小问题，万一没分配成功，例如现在电梯都坏了，怎么办？——使用Exceptions。加一个类：<img src="http://jiayi797.oss-cn-beijing.aliyuncs.com/2018-07-08-17-21-39.png" /></p></li>
<li><p><strong>Take external Reques</strong>t：除了电梯系统要handle，某个电梯也需要handle请求。那就给电梯加一个handleExternalRequest<img src="http://jiayi797.oss-cn-beijing.aliyuncs.com/2018-07-08-17-24-28.png" /></p>
<p>除此以外，我们还有待停list： <img src="http://jiayi797.oss-cn-beijing.aliyuncs.com/2018-07-08-17-28-05.png" /></p></li>
<li><p><strong>Take internal Request</strong>：需要让电梯能处理internal的请求。<img src="http://jiayi797.oss-cn-beijing.aliyuncs.com/2018-07-08-17-30-31.png" /> 除此之外，我们还需要判断现在internal的请求是不是合法的。那就再加一个isQuestValid()和两个状态变量： <img src="http://jiayi797.oss-cn-beijing.aliyuncs.com/2018-07-08-17-31-50.png" /></p></li>
<li><p><strong>Open gate</strong></p>
<p>给电梯加一个openGate()方法 <img src="http://jiayi797.oss-cn-beijing.aliyuncs.com/2018-07-08-17-46-39.png" /></p></li>
<li><p><strong>Close gate</strong></p></li>
</ul>
<p><strong>Check weight</strong></p>
<p><strong>press button</strong></p></li>
</ul>
<p>最终：</p>
<p><img src="http://jiayi797.oss-cn-beijing.aliyuncs.com/2018-07-08-17-51-31.png" /></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://jiayi797.github.io/about/2018/03/29/%E7%B3%BB%E7%BB%9F%E8%AE%BE%E8%AE%A1-%E8%81%8A%E5%A4%A9%E7%B3%BB%E7%BB%9F%E4%B8%8E%E8%AE%BF%E9%97%AE%E9%99%90%E5%88%B6%E7%B3%BB%E7%BB%9F/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="jiayi797">
      <meta itemprop="description" content=".">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="甲乙小朋友的房子">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2018/03/29/%E7%B3%BB%E7%BB%9F%E8%AE%BE%E8%AE%A1-%E8%81%8A%E5%A4%A9%E7%B3%BB%E7%BB%9F%E4%B8%8E%E8%AE%BF%E9%97%AE%E9%99%90%E5%88%B6%E7%B3%BB%E7%BB%9F/" class="post-title-link" itemprop="url">系统设计-聊天系统与访问限制系统</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2018-03-29 16:22:27" itemprop="dateCreated datePublished" datetime="2018-03-29T16:22:27+08:00">2018-03-29</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2018-12-17 15:42:07" itemprop="dateModified" datetime="2018-12-17T15:42:07+08:00">2018-12-17</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E7%B3%BB%E7%BB%9F%E8%AE%BE%E8%AE%A1/" itemprop="url" rel="index"><span itemprop="name">系统设计</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>大纲</p>
<ul>
<li>Design WhatsApp ： 聊天系统
<ul>
<li>Work Solution</li>
<li>Real-time Service</li>
<li>Online Status: Pull vs Push</li>
</ul></li>
<li>Design Rate Limiter</li>
<li>Design Datadog ：一种网站的数据统计，类似于google anaysis</li>
</ul>
<p>这节课之后您可以学会</p>
<ul>
<li>设计聊天系统的核心：Realtime Service</li>
<li>Pull 与 Push 的进一步比较分析</li>
</ul>
<p>相关设计题</p>
<ul>
<li>Design Facebook Messenger</li>
<li>Design WeChat</li>
</ul>
<h1 id="聊天系统">聊天系统</h1>
<h2 id="scenario-场景">Scenario 场景</h2>
<p><strong>设计功能</strong></p>
<ul>
<li>基本功能
<ul>
<li>登录注册</li>
<li>通讯录</li>
<li>两个用户互相发消息</li>
<li>群聊</li>
<li>用户在线状态</li>
</ul></li>
<li>其它功能
<ul>
<li>历史消息</li>
<li>多机登录 multi devices</li>
</ul></li>
</ul>
<p><strong>系统限制</strong></p>
<ul>
<li>活跃
<ul>
<li>1B 月活跃用户</li>
<li>75% 日活跃 / 月活跃</li>
<li>约750M日活跃用户 ——数据来自 Facebook 官方，截止2016年3月</li>
</ul></li>
</ul>
<p>为了计算方便起见，我们来设计一个100M日活跃的WhatsApp</p>
<ul>
<li>QPS：
<ul>
<li>假设平均一个用户每天发20条信息</li>
<li>Average QPS = 100M * 20 / 86400 ~ 20k</li>
<li>Peak QPS = 20k * 5 = 100k</li>
</ul></li>
<li>存储：
<ul>
<li>假设平均一个用户每天发10条信息</li>
<li>一天需要发 1B，每条记录约30bytes的话，大概需要30G的存储</li>
</ul></li>
</ul>
<h2 id="service-服务">Service 服务</h2>
<ul>
<li>Message Service : 负责管理信息</li>
<li>Real-time Service ：负责实时推送信息给接受者</li>
</ul>
<h2 id="storage-存储">Storage 存储</h2>
<p><strong>最简单方法</strong></p>
<p>既然是聊天软件，自然需要一个message table。那么我们需要在message table里面存什么呢？能想到的就是：</p>
<p><img src="http://jiayi797.oss-cn-beijing.aliyuncs.com/2018-03-29-16-37-18.png" /></p>
<p>那么如果按照这个表来存储，那么如果要查询A与B之间的对话，则需要：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> message_table</span><br><span class="line"><span class="keyword">WHERE</span> from_user_id<span class="operator">=</span>A <span class="keyword">and</span> to_user_id<span class="operator">=</span>B <span class="keyword">OR</span> to_user_id<span class="operator">=</span>B <span class="keyword">and</span> from_user_id<span class="operator">=</span>A</span><br><span class="line"><span class="keyword">ORDER</span> <span class="keyword">BY</span> created_at <span class="keyword">DESC</span>;</span><br></pre></td></tr></table></figure>
<p>存在两个问题：</p>
<ul>
<li>效率太低。</li>
<li>群聊咋办？gg了</li>
</ul>
<p><strong>改进——引入thread</strong></p>
<p>thread表示两个的对话！如下图所示，左边是thread。右边是message。</p>
<p><img src="http://jiayi797.oss-cn-beijing.aliyuncs.com/2018-03-29-16-41-05.png" /></p>
<p>那么thread table里面存什么呢？</p>
<p><img src="http://jiayi797.oss-cn-beijing.aliyuncs.com/2018-03-29-16-44-13.png" /></p>
<p>看起来没什么问题。但我们漏了一个东西——如何查询我参与了哪些thread呢？</p>
<p><strong>优化</strong></p>
<p>thread table里面加一个owner_id</p>
<p>有几个拥有者，那么thread table就复制几份！——这样虽然比较浪费空间，但是thread里面有些东西是私有的，比如昵称什么的。</p>
<p><img src="http://jiayi797.oss-cn-beijing.aliyuncs.com/2018-03-29-16-46-02.png" /></p>
<p>问题来了，那么thread table的primary key是什么呢？—— 其实就是owner_id + thread_id的组合呀</p>
<p><strong>流程梳理</strong></p>
<ul>
<li>message table，存储每个人发的每条消息，以及对应的thread_id。即[id, thread_id,user_id,content, created_id]</li>
<li>thread table， 存储每个thread的信息，每个人独享一份数据。即[owner_id,thread_id, participant_ids, is_muted, nickname, created_at, updated_at]</li>
<li>查询我的所有thread list——从thead_table里查询给定user_id的所有thread_id即可。因此thread_table用SQL</li>
<li>查询我的某个thread的大概信息——从thread_table里查询给定owner_id+thread_id的信息</li>
<li>查询我的某个thread的具体消息——从message_table中，根据thread_id查询所有的消息，并且返回.因此message_table用NoSQL</li>
<li>查询我与另一个用户是否有一个thread?</li>
</ul>
<p>即：</p>
<p><img src="http://jiayi797.oss-cn-beijing.aliyuncs.com/2018-03-29-17-09-20.png" /></p>
<p><strong>Word Solution</strong></p>
<p>用户如何发送消息？</p>
<ul>
<li>Client 把消息和接受者信息发送给 server</li>
<li>Server为每个接受者（包括发送者自己）创建一条 Thread （如果没有的话）</li>
<li>创建一条message（with thread_id)</li>
</ul>
<p>用户如何接受消息？</p>
<ul>
<li>可以每隔10秒钟问服务器要一下最新的 inbox 虽然听起来很笨，但是也是我们先得到这样一个可行解再说</li>
<li>如果有新消息就提示用户</li>
</ul>
<h2 id="scale-扩展">Scale 扩展</h2>
<p><strong>sharding</strong></p>
<ul>
<li>Message 是 NoSQL，自带 Scale 属性</li>
<li>Thread 按照 user_id 进行 sharding</li>
</ul>
<p><strong>每隔十秒要inbox?太慢了，优化——Socket</strong></p>
<p>Socket——TCP长连接</p>
<p><strong>Push Service</strong>——提高Socket连接服务，可以与Client保持TCP长连接</p>
<ul>
<li>当用户打开APP之后，就连接上Push Service中属于自己的socket</li>
<li>有人发消息时，Message Service收到消息，通过Push Service把消息发出去</li>
<li>如果一个用户长期不活跃（比如10分钟），就可以断开连接，释放掉网络断开</li>
<li>断开连接之后，如何收到消息？
<ul>
<li>打开APP时主动pull + android GCM/IOS APNS</li>
</ul></li>
<li>Socket连接与HTTP连接的最主要区别；
<ul>
<li>HTTP连接下，只能客户端问服务器要数据</li>
<li>Socket连接下，服务器可以主动推送数据给客户端</li>
</ul></li>
</ul>
<p>流程：</p>
<p><img src="http://jiayi797.oss-cn-beijing.aliyuncs.com/2018-03-29-18-00-44.png" /></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://jiayi797.github.io/about/2018/03/25/%E7%B3%BB%E7%BB%9F%E8%AE%BE%E8%AE%A1-%E4%BB%A5Big-Table%E4%B8%BA%E4%BE%8B%E6%8E%A2%E7%B4%A2%E5%88%86%E5%B8%83%E5%BC%8F%E6%95%B0%E6%8D%AE%E5%BA%93/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="jiayi797">
      <meta itemprop="description" content=".">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="甲乙小朋友的房子">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2018/03/25/%E7%B3%BB%E7%BB%9F%E8%AE%BE%E8%AE%A1-%E4%BB%A5Big-Table%E4%B8%BA%E4%BE%8B%E6%8E%A2%E7%B4%A2%E5%88%86%E5%B8%83%E5%BC%8F%E6%95%B0%E6%8D%AE%E5%BA%93/" class="post-title-link" itemprop="url">系统设计-以Big Table为例探索分布式数据库</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2018-03-25 21:13:05" itemprop="dateCreated datePublished" datetime="2018-03-25T21:13:05+08:00">2018-03-25</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2018-12-17 15:42:07" itemprop="dateModified" datetime="2018-12-17T15:42:07+08:00">2018-12-17</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E7%B3%BB%E7%BB%9F%E8%AE%BE%E8%AE%A1/" itemprop="url" rel="index"><span itemprop="name">系统设计</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>什么是big table? —— 分布式数据库 <img src="http://jiayi797.oss-cn-beijing.aliyuncs.com/2018-03-25-21-14-33.png" /></p>
          <!--noindex-->
            <div class="post-button">
              <a class="btn" href="/2018/03/25/%E7%B3%BB%E7%BB%9F%E8%AE%BE%E8%AE%A1-%E4%BB%A5Big-Table%E4%B8%BA%E4%BE%8B%E6%8E%A2%E7%B4%A2%E5%88%86%E5%B8%83%E5%BC%8F%E6%95%B0%E6%8D%AE%E5%BA%93/#more" rel="contents">
                阅读全文 &raquo;
              </a>
            </div>
          <!--/noindex-->
        
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://jiayi797.github.io/about/2018/03/18/%E7%B3%BB%E7%BB%9F%E8%AE%BE%E8%AE%A1-%E5%88%86%E5%B8%83%E5%BC%8F%E8%AE%A1%E7%AE%97%E7%B3%BB%E7%BB%9F-Map-Reduce%E7%9A%84%E5%8E%9F%E7%90%86%E4%B8%8E%E5%BA%94%E7%94%A8/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="jiayi797">
      <meta itemprop="description" content=".">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="甲乙小朋友的房子">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2018/03/18/%E7%B3%BB%E7%BB%9F%E8%AE%BE%E8%AE%A1-%E5%88%86%E5%B8%83%E5%BC%8F%E8%AE%A1%E7%AE%97%E7%B3%BB%E7%BB%9F-Map-Reduce%E7%9A%84%E5%8E%9F%E7%90%86%E4%B8%8E%E5%BA%94%E7%94%A8/" class="post-title-link" itemprop="url">系统设计-分布式计算系统-Map Reduce的原理与应用</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2018-03-18 20:58:34" itemprop="dateCreated datePublished" datetime="2018-03-18T20:58:34+08:00">2018-03-18</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2018-12-17 15:42:06" itemprop="dateModified" datetime="2018-12-17T15:42:06+08:00">2018-12-17</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E7%B3%BB%E7%BB%9F%E8%AE%BE%E8%AE%A1/" itemprop="url" rel="index"><span itemprop="name">系统设计</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>Map Reduce : 对大数据的快速计算！</p>
<p>经典场景：统计一个网页中的单词频率。（lintcode题——word count）</p>
          <!--noindex-->
            <div class="post-button">
              <a class="btn" href="/2018/03/18/%E7%B3%BB%E7%BB%9F%E8%AE%BE%E8%AE%A1-%E5%88%86%E5%B8%83%E5%BC%8F%E8%AE%A1%E7%AE%97%E7%B3%BB%E7%BB%9F-Map-Reduce%E7%9A%84%E5%8E%9F%E7%90%86%E4%B8%8E%E5%BA%94%E7%94%A8/#more" rel="contents">
                阅读全文 &raquo;
              </a>
            </div>
          <!--/noindex-->
        
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://jiayi797.github.io/about/2018/03/11/%E7%B3%BB%E7%BB%9F%E8%AE%BE%E8%AE%A1-%E7%88%AC%E8%99%AB%E7%B3%BB%E7%BB%9F%E4%B8%8E%E6%90%9C%E7%B4%A2%E5%BB%BA%E8%AE%AE%E7%B3%BB%E7%BB%9F/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="jiayi797">
      <meta itemprop="description" content=".">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="甲乙小朋友的房子">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2018/03/11/%E7%B3%BB%E7%BB%9F%E8%AE%BE%E8%AE%A1-%E7%88%AC%E8%99%AB%E7%B3%BB%E7%BB%9F%E4%B8%8E%E6%90%9C%E7%B4%A2%E5%BB%BA%E8%AE%AE%E7%B3%BB%E7%BB%9F/" class="post-title-link" itemprop="url">系统设计-爬虫系统与搜索建议系统</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2018-03-11 20:40:56" itemprop="dateCreated datePublished" datetime="2018-03-11T20:40:56+08:00">2018-03-11</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2018-12-17 15:42:07" itemprop="dateModified" datetime="2018-12-17T15:42:07+08:00">2018-12-17</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E7%B3%BB%E7%BB%9F%E8%AE%BE%E8%AE%A1/" itemprop="url" rel="index"><span itemprop="name">系统设计</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>大纲</p>
<ul>
<li>设计一个web爬虫</li>
<li>线程安全的生产者-消费者模式</li>
<li>搜索建议系统</li>
</ul>
<h1 id="爬虫">爬虫</h1>
<p>搜索引擎如何爬取网页呢？也就是我们想获取如下所示的表：</p>
<p><img src="http://jiayi797.oss-cn-beijing.aliyuncs.com/2018-03-11-20-43-31.png" /></p>
<p>那么想要用程序完成这个目标，我们首先要知道一个事实，也就是互联网上的内容其实是互相索引的，也就是就像如下的大网一样：</p>
<p><img src="http://jiayi797.oss-cn-beijing.aliyuncs.com/2018-03-11-20-45-46.png" /></p>
<p>假设一共有1trillion个网页，而且至少一周更新一次。那么每秒要爬取1.6m网页。每页大概10k，那么些网页存储下来大概需要10p的存储空间。</p>
<p><strong>单线程爬虫</strong></p>
<p>一般来说，爬虫是用BFS进行爬取的。对于单线程的爬虫来说，就是搞一个队列：</p>
<p><img src="http://jiayi797.oss-cn-beijing.aliyuncs.com/2018-03-11-21-00-09.png" /></p>
<p><strong>生产者-消费者模型</strong></p>
<p><img src="http://jiayi797.oss-cn-beijing.aliyuncs.com/2018-03-11-21-16-37.png" /></p>
<p>也就是生产者一直往里怼任务，消费者拿任务。中间有一个Buffer(原因是存取速度不一样)。</p>
<p>那么回头看看我们的爬虫，其实URL extractor就是生产者，而Web page loader就是消费者。</p>
<p>但是单线程有一个问题，就是慢的很。解决——多线程爬虫</p>
<p><strong>多线程爬虫</strong></p>
<p>这些线程共享同一个URL队列，那么这个队列就要加锁。（DFS没有办法实现这个多线程，因此用BFS）</p>
<p><img src="http://jiayi797.oss-cn-beijing.aliyuncs.com/2018-03-11-21-20-11.png" /></p>
<p>需要注意的是，争取共享资源，就要考虑以下三个机制：</p>
<ul>
<li>sleep —— 就是随机睡一会，但问题在于无法立马知道资源可以使用了</li>
<li>信号量（实现互斥）—— 相当于所有的线程都在等着，然后信号量通知他们能用的时候，就抢着占用资源</li>
<li>semaphore —— 就像门上挂上五把钥匙一样，能够解决抢占资源的问题</li>
</ul>
<p>单线程 --&gt; 多线程：</p>
<ul>
<li>线程来回切换(context switch)还是有花费（需要保存线程执行状态，还需要切换二级缓存等）的，因此线程不能太多</li>
<li>线程端口数目是有限的（TCP/IP协议中，端口只有2个字节，也就是65536个端口）</li>
</ul>
<p>因此我们可以改进一下：</p>
<p><strong>分布式爬虫</strong></p>
<p><img src="http://jiayi797.oss-cn-beijing.aliyuncs.com/2018-03-11-21-56-25.png" /></p>
<p>分布式爬虫虽然解决了线程不能太多的问题，但是又带来了一个问题：URL队列在内存中放不下了（假设1trillion，差不多要40T的内存）！这是不行的。那么我们考虑一下存在硬盘里，也就是数据库里。</p>
<p>最要命的限制是：没有办法控制网页的顺序和优先级啊！</p>
<p>解决：给数据库加入一个优先级的列，再加一个频率的列</p>
<p><img src="http://jiayi797.oss-cn-beijing.aliyuncs.com/2018-03-11-22-01-00.png" /></p>
<p>每一行是一个任务：</p>
<ul>
<li>ID,URL</li>
<li>state：是否正在运行的状态（即能去重，也能防止重复运算）</li>
<li>priority：优先级</li>
<li>available_time：控制抓取频率，也就是这个时刻之后再进行抓取。如果本次有更新，那么就把时间设置地更近一些；如果本次没有更新，那么就把时间设置地更远一些</li>
</ul>
<p><img src="http://jiayi797.oss-cn-beijing.aliyuncs.com/2018-03-11-22-04-54.png" /></p>
<ul>
<li>webPageStorage : 分布式存储，存储爬取的东西</li>
<li>爬虫</li>
<li>Task table : 就是上面的任务表</li>
</ul>
<p><strong>总结</strong></p>
<p>场景：多少网页？频率？有多大？</p>
<p>服务：爬虫、Task Service、存储系统</p>
<p>存储：用db存储task，一个超大的BigTable存储web pages</p>
<p><strong>遇到的问题</strong></p>
<p><strong>task table 最终会非常大！1 trillion 个task，而且会越来越大</strong></p>
<p>解决——拆表，加速select</p>
<p><img src="http://jiayi797.oss-cn-beijing.aliyuncs.com/2018-03-11-22-13-52.png" /></p>
<p>那么拆表就有一个细节需要注意，需要一个scheduler，用来安排去哪里要数据。</p>
<p><strong>网页抓取频率问题</strong></p>
<p>如何控制抓取频率呢？有一个暴力的方法：</p>
<ul>
<li>如果本次抓了有更新，那就把下次抓取的时间提前一半</li>
<li>如果本次抓了没更新，就把下次抓取的时间往后移2倍</li>
</ul>
<p><strong>如何处理死循环问题？</strong></p>
<p>有些网站是互相指向的，比如sina.com。而且所有的URL都是与sina.com差不多的。这样就会使用大量的资源去抓取这种巨型网站，太耗费资源了。对于那些小博客就不公平。</p>
<p>解决办法：单位时间对同一个网站，不要分配过多的计算资源就好啦。</p>
<p><img src="http://jiayi797.oss-cn-beijing.aliyuncs.com/2018-03-11-22-21-31.png" /></p>
<h1 id="typeahead">Typeahead</h1>
<p>Google Type ahead ——</p>
<p><img src="http://jiayi797.oss-cn-beijing.aliyuncs.com/2018-03-11-22-23-31.png" /></p>
<p>我们以google Suggesion为例</p>
<p><strong>场景</strong></p>
<ul>
<li>日活跃：500m</li>
<li>搜索量：4 x 6 x 500m = 12b （每人搜索6次，输入4个单词 = 使用了typeahead四次）</li>
<li>QPS : 12b / 86400 = 138k</li>
<li>Peak QPS = QPS X 2 = 276k</li>
</ul>
<p><strong>服务</strong></p>
<p>要求：敲下一个字母，就赶紧返回热门词才行</p>
<p><img src="http://jiayi797.oss-cn-beijing.aliyuncs.com/2018-03-11-22-34-32.png" /></p>
<ul>
<li>QuerySerivce : 完成typeahead行为</li>
<li>DataCollectionService : 收集数据、将热门词数据提供给QueryService</li>
</ul>
<p>影响QueryService的执行时间的最关键因素就是数据结构，其实用Trie树就够了。这里不做过多的介绍。</p>
<p>DataCollectionService对Trie的更新就是个问题。当然不可以直接更新线上Memory中的索引。解决方式，就是在另一台机器上进行更新，另一台机器上的Trie跟这台机器磁盘上的Trie一样的。那就在另一台机器上先加载Trie树到内存，然后更新，再写入硬盘。再同步过去。</p>
<p><img src="http://jiayi797.oss-cn-beijing.aliyuncs.com/2018-03-11-22-41-28.png" /></p>
<p><strong>Trie树一台机器的内存存不下咋办？</strong></p>
<p>分机器存哇。</p>
<p><img src="http://jiayi797.oss-cn-beijing.aliyuncs.com/2018-03-11-22-42-22.png" /></p>
<p>那么怎么分呢？</p>
<ul>
<li>按照字母分？ 会存在严重的不平衡问题，因为有的字母的词超多。</li>
<li>分布式存：</li>
</ul>
<p><strong>存储</strong></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://jiayi797.github.io/about/2018/03/10/%E7%AE%97%E6%B3%95-%E6%8E%92%E5%BA%8F%E6%80%BB%E7%BB%93/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="jiayi797">
      <meta itemprop="description" content=".">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="甲乙小朋友的房子">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2018/03/10/%E7%AE%97%E6%B3%95-%E6%8E%92%E5%BA%8F%E6%80%BB%E7%BB%93/" class="post-title-link" itemprop="url">算法-排序总结</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2018-03-10 13:41:04" itemprop="dateCreated datePublished" datetime="2018-03-10T13:41:04+08:00">2018-03-10</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2018-12-17 15:42:05" itemprop="dateModified" datetime="2018-12-17T15:42:05+08:00">2018-12-17</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E7%AE%97%E6%B3%95/" itemprop="url" rel="index"><span itemprop="name">算法</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>常见的排序算法有以下几种：</p>
<ul>
<li>递归性排序
<ul>
<li><a href="/2017/07/23/%E7%AE%97%E6%B3%95-%E5%BD%92%E5%B9%B6%E6%8E%92%E5%BA%8F/" title="算法-归并排序">算法-归并排序</a>
：归并排序的主要思想是分治，也就是先把数组分成两部分，当两部分都有序时，然后再将两部分进行二路归并。需要注意的是归并排序的时间复杂度分析方法，就是画出<span class="math inline">\(T(n) = 2T(n/2) + cn\)</span> 的递归树，并计算最终时间复杂度。但是要注意的是，归并排序在进行二路归并时，可能会产生额外的空间复杂度。</li>
<li><a href="/2017/07/17/%E7%AE%97%E6%B3%95-%E5%BF%AB%E9%80%9F%E6%8E%92%E5%BA%8F/" title="算法-快速排序">算法-快速排序</a>
：快速排序的思路也是分治，但分治之前需要选择一个主元作为基准，将主元放在应该在的位置，并且数组左边比主元小，右边比主元大。这样如果当左边有序和右边有序时，整个数组就有序了。假设主元位置为i，快速排序复杂度为<span class="math inline">\(T(n) = T(i) + T(n - i - 1) + cn​\)</span> 。由于i的不确定性导致快速排序的最坏情况下时间复杂度为<span class="math inline">\(T(n) = T(n-1) + T(0) + cn = O(n^2)\)</span> ，而平均情况下是<span class="math inline">\(T(n) = 2T(\frac{n-1}{2}) +cn = nlogn\)</span>。 快速排序不需要额外的空间。</li>
</ul></li>
<li>非递归型排序
<ul>
<li><a href="/2017/07/20/%E7%AE%97%E6%B3%95-%E6%8F%92%E5%85%A5%E6%8E%92%E5%BA%8F/" title="算法-插入排序">算法-插入排序</a>
：每次将一个待排序的记录，按其关键字大小插入到前面已经排好序的子序列中的适当位置，直到全部记录插入完成为止。</li>
<li><a href="/2017/07/22/%E7%AE%97%E6%B3%95-%E9%80%89%E6%8B%A9%E6%8E%92%E5%BA%8F/" title="算法-选择排序">算法-选择排序</a>
：每次从无序区选择一个最小的放大有序区的最后</li>
<li><a href="/2017/07/19/%E7%AE%97%E6%B3%95-%E5%86%92%E6%B3%A1%E6%8E%92%E5%BA%8F/" title="算法-冒泡排序">算法-冒泡排序</a>
：依次比较相邻的两个数据，如果前面的比后面的大，就将其交换；这样交换一轮之后，整个序列中最大的就“沉”到了最后面的位置；重复上述过程，依次把第二大、第三大…的数字放到后面的位置。</li>
<li><a href="/2017/07/22/%E7%AE%97%E6%B3%95-%E5%B8%8C%E5%B0%94%E6%8E%92%E5%BA%8F/" title="算法-希尔排序">算法-希尔排序</a>
：分组插入排序</li>
</ul></li>
<li>非比较排序：非比较排序的时间复杂度可以达到<span class="math inline">\(O(n)\)</span> 。
<ul>
<li><a href="/2018/02/08/%E7%AE%97%E6%B3%95-%E8%AE%A1%E6%95%B0%E6%8E%92%E5%BA%8F%E3%80%81%E5%9F%BA%E6%95%B0%E6%8E%92%E5%BA%8F%E3%80%81%E6%A1%B6%E6%8E%92%E5%BA%8F/" title="算法-计数排序、基数排序、桶排序">算法-计数排序、基数排序、桶排序</a>
<ul>
<li>计数排序：已知最大值K。利用数组<code>int[K]</code> 统计每个数字的小于等于它的个数，将这个个数作为这个数字的idx</li>
<li>基数排序：分别对数字的个位、十位、...、d位依次进行计数排序</li>
<li>桶排序：将数字分别放入桶里。</li>
</ul></li>
</ul></li>
</ul>
<p>因此我们做出如下总结：</p>
<table>
<thead>
<tr class="header">
<th>排序方法</th>
<th>平均时间复杂度</th>
<th>最坏时间复杂度</th>
<th>空间复杂度</th>
<th>其它要点</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>归并</td>
<td><span class="math inline">\(O(nlogn)\)</span></td>
<td><span class="math inline">\(O(nlogn)\)</span></td>
<td><span class="math inline">\(O(n)\)</span></td>
<td>递归树</td>
</tr>
<tr class="even">
<td>快排</td>
<td><span class="math inline">\(O(nlogn)\)</span></td>
<td><span class="math inline">\(O(n^2)\)</span></td>
<td><span class="math inline">\(O(1)\)</span></td>
<td>快速选择 <a href="/2017/12/11/%E7%AE%97%E6%B3%95-%E6%95%B0%E7%BB%84%E4%B8%8E%E6%95%B0/" title="Kth Largest Element">Kth Largest Element</a> <br />快排优化算法<br /></td>
</tr>
<tr class="odd">
<td>插入、<br />选择、<br />冒泡、<br />希尔</td>
<td><span class="math inline">\(O(n^2)\)</span></td>
<td><span class="math inline">\(O(n^2)\)</span></td>
<td><span class="math inline">\(O(1)\)</span></td>
<td></td>
</tr>
<tr class="even">
<td>计数排序</td>
<td><span class="math inline">\(O(n)\)</span></td>
<td><span class="math inline">\(O(n)\)</span></td>
<td><span class="math inline">\(O(K)\)</span></td>
<td>已知数组最大值K</td>
</tr>
<tr class="odd">
<td>基数排序</td>
<td><span class="math inline">\(O(d(n+10))\)</span></td>
<td><span class="math inline">\(O(d(n+10))\)</span></td>
<td><span class="math inline">\(O(10)\)</span></td>
<td></td>
</tr>
<tr class="even">
<td>桶排序</td>
<td><span class="math inline">\(O(n)\)</span></td>
<td></td>
<td><span class="math inline">\(O(n)\)</span></td>
<td>大数排序<br /></td>
</tr>
</tbody>
</table>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://jiayi797.github.io/about/2018/03/09/%E7%AE%97%E6%B3%95-%E7%BA%A2%E9%BB%91%E6%A0%91/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="jiayi797">
      <meta itemprop="description" content=".">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="甲乙小朋友的房子">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2018/03/09/%E7%AE%97%E6%B3%95-%E7%BA%A2%E9%BB%91%E6%A0%91/" class="post-title-link" itemprop="url">算法-红黑树</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2018-03-09 19:31:31" itemprop="dateCreated datePublished" datetime="2018-03-09T19:31:31+08:00">2018-03-09</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2018-12-17 15:42:05" itemprop="dateModified" datetime="2018-12-17T15:42:05+08:00">2018-12-17</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E7%AE%97%E6%B3%95/" itemprop="url" rel="index"><span itemprop="name">算法</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>红黑树本质上是一种二叉查找树，但它在二叉查找树的基础上额外添加了一个标记（颜色），同时具有一定的规则。这些规则使红黑树保证了一种平衡，插入、删除、查找的最坏时间复杂度都为 O(logn)。</p>
<p>它的统计性能要好于平衡二叉树（AVL树），因此，红黑树在很多地方都有应用。比如在 <a href="https://link.juejin.im/?target=http%3A%2F%2Flib.csdn.net%2Fbase%2Fjavaee">Java</a> 集合框架中，很多部分(TreeMap, TreeSet 等)都有红黑树的应用，这些集合均提供了很好的性能。</p>
<p>由于 TreeMap 就是由红黑树实现的，因此本文将使用 TreeMap 的相关操作的代码进行分析、论证。</p>
          <!--noindex-->
            <div class="post-button">
              <a class="btn" href="/2018/03/09/%E7%AE%97%E6%B3%95-%E7%BA%A2%E9%BB%91%E6%A0%91/#more" rel="contents">
                阅读全文 &raquo;
              </a>
            </div>
          <!--/noindex-->
        
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://jiayi797.github.io/about/2018/03/08/%E7%B3%BB%E7%BB%9F%E8%AE%BE%E8%AE%A1-%E4%BB%A5GFS%E4%B8%BA%E4%BE%8B%E6%8E%A2%E7%B4%A2%E5%88%86%E5%B8%83%E5%BC%8F%E6%96%87%E4%BB%B6%E7%B3%BB%E7%BB%9F/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="jiayi797">
      <meta itemprop="description" content=".">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="甲乙小朋友的房子">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2018/03/08/%E7%B3%BB%E7%BB%9F%E8%AE%BE%E8%AE%A1-%E4%BB%A5GFS%E4%B8%BA%E4%BE%8B%E6%8E%A2%E7%B4%A2%E5%88%86%E5%B8%83%E5%BC%8F%E6%96%87%E4%BB%B6%E7%B3%BB%E7%BB%9F/" class="post-title-link" itemprop="url">系统设计-以GFS为例探索分布式文件系统</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2018-03-08 20:33:37" itemprop="dateCreated datePublished" datetime="2018-03-08T20:33:37+08:00">2018-03-08</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2018-12-17 15:42:07" itemprop="dateModified" datetime="2018-12-17T15:42:07+08:00">2018-12-17</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E7%B3%BB%E7%BB%9F%E8%AE%BE%E8%AE%A1/" itemprop="url" rel="index"><span itemprop="name">系统设计</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="什么是分布式系统">什么是分布式系统</h1>
<p>用多台机器解决一台机器不能解决的问题。比如存储不够？QPS太大？</p>
<p>谷歌三剑客</p>
<ul>
<li>分布式文件系统
<ul>
<li>怎么有效存储数据？</li>
<li>NoSQL底层需要一个文件系统</li>
</ul></li>
<li>Map Reduce
<ul>
<li>怎么快速处理系统？</li>
</ul></li>
<li>Big table = No-SQL Database
<ul>
<li>怎么连接底层存储和上层数据</li>
</ul></li>
</ul>
<p>本节课内容：</p>
<ul>
<li>Master Slave Pattern</li>
<li>How to check and handle system failure and error</li>
<li>How to design Distributed File System</li>
</ul>
          <!--noindex-->
            <div class="post-button">
              <a class="btn" href="/2018/03/08/%E7%B3%BB%E7%BB%9F%E8%AE%BE%E8%AE%A1-%E4%BB%A5GFS%E4%B8%BA%E4%BE%8B%E6%8E%A2%E7%B4%A2%E5%88%86%E5%B8%83%E5%BC%8F%E6%96%87%E4%BB%B6%E7%B3%BB%E7%BB%9F/#more" rel="contents">
                阅读全文 &raquo;
              </a>
            </div>
          <!--/noindex-->
        
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://jiayi797.github.io/about/2018/03/06/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0%E5%AE%9E%E8%B7%B5-XGboost%E4%B8%8ELightGBM%E5%AF%B9%E6%AF%94/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="jiayi797">
      <meta itemprop="description" content=".">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="甲乙小朋友的房子">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2018/03/06/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0%E5%AE%9E%E8%B7%B5-XGboost%E4%B8%8ELightGBM%E5%AF%B9%E6%AF%94/" class="post-title-link" itemprop="url">机器学习实践-XGboost与LightGBM对比</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2018-03-06 15:18:10" itemprop="dateCreated datePublished" datetime="2018-03-06T15:18:10+08:00">2018-03-06</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2019-03-29 11:37:31" itemprop="dateModified" datetime="2019-03-29T11:37:31+08:00">2019-03-29</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0%E5%AE%9E%E8%B7%B5/" itemprop="url" rel="index"><span itemprop="name">机器学习实践</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="xgboost">XGBoost</h1>
<p>XGBoost作为一款经过优化的分布式梯度提升（Gradient Boosting）库，具有高效，灵活和高可移植性的特点。基于梯度提升框架，XGBoost实现了并行方式的决策树提升(Tree Boosting)，从而能够快速准确地解决各种数据科学问题。XGBoost不仅支持各种单机操作系统（如：Windows，Linus和OS X），而且支持集群分布式计算(如：AWS，GCE，Azure和Yarn)和云数据流系统（如：Flink和Spark）。</p>
<p>XGBoost是由华盛顿大学（University of Washington）的陈天奇作为 Distributed (Deep) Machine Learning Community (DMLC) 组员所开发的一个研究项目。在陈天奇与队友一起赢得了Higgs Machine Learning Challenge后，许多的数据科学竞赛队伍使用XGBoost并获得了冠军，促进了该工具在数据科学应用中的广泛使用。</p>
<h1 id="lightgbm">LightGBM</h1>
<p>LightGBM（Light Gradient Boosting Machine）同样是一款基于决策树算法的分布式梯度提升框架。为了满足工业界缩短模型计算时间的需求，LightGBM的设计思路主要是两点：1. 减小数据对内存的使用，保证单个机器在不牺牲速度的情况下，尽可能地用上更多的数据；2. 减小通信的代价，提升多机并行时的效率，实现在计算上的线性加速。由此可见，LightGBM的设计初衷就是提供一个快速高效、低内存占用、高准确度、支持并行和大规模数据处理的数据科学工具。</p>
<p>LightGBM是微软旗下的Distributed Machine Learning Toolkit （DMKT）的一个项目，由2014年首届阿里巴巴大数据竞赛获胜者之一柯国霖主持开发。虽然其开源时间才仅仅2个月，但是其快速高效的特点已经在数据科学竞赛中崭露头角。Allstate Claims Severity竞赛中的冠军解决方案里就使用了LightGBM，并对其大嘉赞赏。</p>
          <!--noindex-->
            <div class="post-button">
              <a class="btn" href="/2018/03/06/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0%E5%AE%9E%E8%B7%B5-XGboost%E4%B8%8ELightGBM%E5%AF%B9%E6%AF%94/#more" rel="contents">
                阅读全文 &raquo;
              </a>
            </div>
          <!--/noindex-->
        
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://jiayi797.github.io/about/2018/03/05/%E7%AE%97%E6%B3%95-%E5%8D%A1%E5%85%B0%E7%89%B9%E6%95%B0/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="jiayi797">
      <meta itemprop="description" content=".">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="甲乙小朋友的房子">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2018/03/05/%E7%AE%97%E6%B3%95-%E5%8D%A1%E5%85%B0%E7%89%B9%E6%95%B0/" class="post-title-link" itemprop="url">算法-卡兰特数</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2018-03-05 12:53:38" itemprop="dateCreated datePublished" datetime="2018-03-05T12:53:38+08:00">2018-03-05</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2018-12-17 15:42:05" itemprop="dateModified" datetime="2018-12-17T15:42:05+08:00">2018-12-17</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E7%AE%97%E6%B3%95/" itemprop="url" rel="index"><span itemprop="name">算法</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="出栈顺序问题">出栈顺序问题</h1>
<p>今天看到一道出栈顺序的面试题，很心的思路。特来注意一下。</p>
<p><strong>问题定义</strong></p>
<p>一个栈(无穷大)的进栈序列为1，2，3，…，n，有多少个不同的出栈序列?</p>
<p><strong>解题思路</strong></p>
<ol type="1">
<li>假设进栈序列为<span class="math inline">\([a,b,c,d]\)</span> . 设<span class="math inline">\(f(k)\)</span> 表示还剩k个元素时的出栈序列数目（元素内容并不影响数目，例如abc与abd的出栈序列数目是一样的）</li>
<li>如果a第1个出栈，那么只有可能就是a进栈后马上出栈。还剩bcd等待操作。那么就是子问题<span class="math inline">\(f(3)\)</span></li>
<li>如果a第2个出栈，那么一定有一个元素先比a进栈，这个元素只可能是b。那么就是子问题<span class="math inline">\(f(1)\)</span>。 而还剩下cd等待操作，那么cd就是子问题<span class="math inline">\(f(2)\)</span></li>
<li>如果a第3个出栈，那么一定有2个元素比a先出栈，这2个元素只可能是bc，就是子问题<span class="math inline">\(f(2)\)</span> 。而剩下的d就是<span class="math inline">\(f(1)\)</span></li>
<li>如果a第4个出栈，那么一定是a进栈后，等到bcd都出栈后再出栈。那么bcd就是<span class="math inline">\(f(3)\)</span></li>
</ol>
<p>结合以上所有情况，即<span class="math inline">\(f(4) = f(3) + f(2)\times f(1) + f(1) \times f(2) + f(3)\)</span></p>
<p>为了好看，我们定义<span class="math inline">\(f(0) = 1\)</span> ，然后推广到n，那么可以得到：</p>
<p><span class="math display">\[f(n) =f(0)\times f(n) + f（1)\times f(n-1) +...+f(k)(n-k)+...+ f(n-1) \times f(1) + f(n) \times f(0)\]</span></p>
<p><span class="math display">\[ = \sum_{i=0}^{n-1} f(i)f(n-i)\]</span></p>
          <!--noindex-->
            <div class="post-button">
              <a class="btn" href="/2018/03/05/%E7%AE%97%E6%B3%95-%E5%8D%A1%E5%85%B0%E7%89%B9%E6%95%B0/#more" rel="contents">
                阅读全文 &raquo;
              </a>
            </div>
          <!--/noindex-->
        
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  


  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/page/2/"><i class="fa fa-angle-left" aria-label="上一页"></i></a><a class="page-number" href="/">1</a><a class="page-number" href="/page/2/">2</a><span class="page-number current">3</span><a class="page-number" href="/page/4/">4</a><span class="space">&hellip;</span><a class="page-number" href="/page/15/">15</a><a class="extend next" rel="next" href="/page/4/"><i class="fa fa-angle-right" aria-label="下一页"></i></a>
  </nav>



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">jiayi797</p>
  <div class="site-description" itemprop="description">.</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">150</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
        <span class="site-state-item-count">34</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
        <span class="site-state-item-count">32</span>
        <span class="site-state-item-name">标签</span>
      </div>
  </nav>
</div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2023</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">jiayi797</span>
</div>
  <div class="powered-by">由 <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://muse.theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Muse</a> 强力驱动
    <span class="post-count">| 博客共334.5k字</span>
  </div>

        








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/muse.js"></script>


<script src="/js/next-boot.js"></script>




  















  

  

</body>
</html>
